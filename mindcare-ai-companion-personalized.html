<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MindCare Connect - Your Personalized Mental Health Companion</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366F1;
            --primary-dark: #4F46E5;
            --secondary: #10B981;
            --accent: #F59E0B;
            --danger: #EF4444;
            --info: #3B82F6;
            --purple: #8B5CF6;
            --pink: #EC4899;
            --gold: #FFD700;
            --bg-main: #F9FAFB;
            --bg-card: #FFFFFF;
            --text-dark: #111827;
            --text-medium: #6B7280;
            --text-light: #9CA3AF;
            --border: #E5E7EB;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-main);
            color: var(--text-dark);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            padding-bottom: 80px;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--primary), var(--purple));
            color: white;
            padding: 25px 0;
            box-shadow: var(--shadow-lg);
            margin-bottom: 30px;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .logo {
            font-size: 1.6em;
            font-weight: bold;
        }

        .user-role-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .progress-system {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .level-container {
            position: relative;
            width: 80px;
            height: 80px;
        }

        .level-ring {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(var(--gold) 0deg, var(--gold) var(--level-progress, 0deg), rgba(255, 255, 255, 0.2) var(--level-progress, 0deg));
            display: flex;
            align-items: center;
            justify-content: center;
            animation: rotate 2s linear infinite;
        }

        @keyframes rotate {
            0% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
            100% { filter: brightness(1); }
        }

        .level-inner {
            width: 90%;
            height: 90%;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .level-number {
            font-size: 1.5em;
            font-weight: bold;
            color: var(--primary);
        }

        .level-label {
            font-size: 0.6em;
            color: var(--text-medium);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            flex: 1;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.15);
            padding: 12px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .stat-item:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 3px;
        }

        .stat-label {
            font-size: 0.75em;
            opacity: 0.9;
        }

        /* Onboarding Modal */
        .onboarding-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .onboarding-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.5s ease;
        }

        .onboarding-step {
            display: none;
        }

        .onboarding-step.active {
            display: block;
        }

        .onboarding-title {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .onboarding-subtitle {
            color: var(--text-medium);
            margin-bottom: 30px;
        }

        .role-options, .preference-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .role-card, .preference-card {
            background: var(--bg-main);
            border: 3px solid var(--border);
            border-radius: 15px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .role-card:hover, .preference-card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .role-card.selected, .preference-card.selected {
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
        }

        .role-icon, .preference-icon {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .role-name, .preference-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .role-desc, .preference-desc {
            font-size: 0.85em;
            color: var(--text-medium);
        }

        /* Today's Focus Card */
        .focus-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }

        .focus-card::before {
            content: '‚ú®';
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 3em;
            opacity: 0.3;
        }

        .focus-title {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .focus-recommendations {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .focus-item {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .focus-item:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-3px);
        }

        .focus-item-icon {
            font-size: 2em;
            margin-bottom: 8px;
        }

        .focus-item-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .focus-item-reason {
            font-size: 0.85em;
            opacity: 0.9;
        }

        /* Daily Challenge Card */
        .challenge-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow-lg);
        }

        .challenge-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .challenge-title {
            font-size: 1.3em;
            font-weight: bold;
        }

        .challenge-reward {
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 15px;
            border-radius: 15px;
            font-weight: 600;
        }

        .challenge-progress {
            background: rgba(255, 255, 255, 0.2);
            height: 10px;
            border-radius: 10px;
            margin-top: 15px;
            overflow: hidden;
        }

        .challenge-progress-fill {
            background: white;
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        /* Mood Tracker */
        .mood-tracker {
            background: var(--bg-card);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        .mood-quick-check {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .mood-option {
            flex: 1;
            min-width: 80px;
            background: var(--bg-main);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 15px 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .mood-option:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
        }

        .mood-option.selected {
            border-color: var(--primary);
            background: var(--primary);
            color: white;
        }

        .mood-emoji {
            font-size: 2em;
            display: block;
            margin-bottom: 5px;
        }

        .mood-label {
            font-size: 0.85em;
            font-weight: 600;
        }

        .mood-dimensions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .mood-dimension {
            background: var(--bg-main);
            padding: 15px;
            border-radius: 12px;
        }

        .dimension-label {
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
        }

        .dimension-slider {
            width: 100%;
            height: 8px;
            border-radius: 10px;
            background: var(--border);
            appearance: none;
            outline: none;
        }

        .dimension-slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
        }

        /* Navigation */
        nav {
            background: var(--bg-card);
            border-radius: 15px;
            box-shadow: var(--shadow-md);
            margin-bottom: 25px;
            padding: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            position: sticky;
            top: 20px;
            z-index: 100;
            border: 1px solid var(--border);
        }

        .nav-btn {
            background: transparent;
            color: var(--text-medium);
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-btn:hover {
            background: var(--bg-main);
            color: var(--primary);
        }

        .nav-btn.active {
            background: var(--primary);
            color: white;
        }

        /* Filter System */
        .filter-panel {
            background: var(--bg-card);
            border-radius: 15px;
            box-shadow: var(--shadow);
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid var(--border);
        }

        .filter-section {
            margin-bottom: 15px;
        }

        .filter-section:last-child {
            margin-bottom: 0;
        }

        .filter-label {
            font-weight: 600;
            margin-bottom: 10px;
            display: block;
        }

        .filter-tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .filter-tag {
            padding: 6px 14px;
            border: 2px solid var(--border);
            background: white;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.3s ease;
        }

        .filter-tag:hover {
            border-color: var(--primary);
            background: var(--bg-main);
        }

        .filter-tag.active {
            border-color: var(--primary);
            background: var(--primary);
            color: white;
        }

        /* Exercise Cards */
        .exercises-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .exercise-card {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .exercise-card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .exercise-card.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .exercise-card.recommended {
            border-color: var(--gold);
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.05), rgba(255, 165, 0, 0.05));
        }

        .exercise-icon {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .exercise-name {
            font-size: 1em;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .exercise-tags {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 10px 0;
        }

        .exercise-tag {
            background: var(--bg-main);
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.7em;
            color: var(--text-medium);
        }

        .exercise-points {
            background: linear-gradient(135deg, var(--gold), #FFA500);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 600;
            display: inline-block;
            margin-top: 5px;
        }

        .multiplier-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--danger);
            color: white;
            padding: 5px 10px;
            border-radius: 10px;
            font-size: 0.75em;
            font-weight: bold;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: var(--bg-card);
            margin: 3% auto;
            padding: 35px;
            border-radius: 20px;
            max-width: 800px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border);
        }

        .modal-title {
            font-size: 1.8em;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 2em;
            cursor: pointer;
            color: var(--text-medium);
            transition: all 0.3s ease;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close-btn:hover {
            background: var(--bg-main);
            color: var(--danger);
        }

        /* Interactive Elements */
        .breathing-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--purple));
            margin: 30px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5em;
            font-weight: bold;
            box-shadow: 0 0 40px rgba(99, 102, 241, 0.3);
            transition: all 4s ease-in-out;
        }

        .breathing-circle.inhale {
            transform: scale(1.3);
        }

        .breathing-circle.exhale {
            transform: scale(1);
        }

        /* Buttons */
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: var(--shadow);
        }

        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-success {
            background: var(--secondary);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-full {
            width: 100%;
            justify-content: center;
        }

        /* Learning Quiz */
        .quiz-container {
            margin: 20px 0;
        }

        .quiz-question {
            background: var(--bg-main);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .quiz-options {
            display: grid;
            gap: 10px;
        }

        .quiz-option {
            background: white;
            border: 2px solid var(--border);
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quiz-option:hover {
            border-color: var(--primary);
        }

        .quiz-option.correct {
            border-color: var(--secondary);
            background: rgba(16, 185, 129, 0.1);
        }

        .quiz-option.incorrect {
            border-color: var(--danger);
            background: rgba(239, 68, 68, 0.1);
        }

        /* Achievements */
        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .achievement-item {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .achievement-item.unlocked {
            border-color: var(--gold);
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 165, 0, 0.1));
        }

        .achievement-item.locked {
            opacity: 0.4;
        }

        .achievement-badge {
            font-size: 3em;
            margin-bottom: 10px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .exercises-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            }

            .modal-content {
                margin: 10% 5%;
                padding: 25px;
            }

            .focus-recommendations {
                grid-template-columns: 1fr;
            }
        }

        .hidden { display: none; }
    </style>
</head>
<body>
    <!-- Onboarding Modal -->
    <div id="onboardingModal" class="onboarding-modal hidden">
        <div class="onboarding-content">
            <!-- Step 1: Welcome -->
            <div class="onboarding-step active" data-step="1">
                <div class="onboarding-title">Welcome to MindCare! üëã</div>
                <div class="onboarding-subtitle">Let's personalize your experience in just a few steps</div>
                <div style="text-align: center; margin: 40px 0;">
                    <div style="font-size: 5em;">üß†</div>
                    <p style="margin-top: 20px; color: var(--text-medium);">
                        We'll ask a few questions to tailor content and activities to your needs
                    </p>
                </div>
                <button class="btn btn-full" onclick="nextOnboardingStep()">Get Started</button>
            </div>

            <!-- Step 2: Role Selection -->
            <div class="onboarding-step" data-step="2">
                <div class="onboarding-title">Who are you here for?</div>
                <div class="onboarding-subtitle">Select all that apply - we'll customize content for you</div>
                <div class="role-options">
                    <div class="role-card" data-role="patient" onclick="toggleRole(this)">
                        <div class="role-icon">üßò</div>
                        <div class="role-name">Myself</div>
                        <div class="role-desc">Managing my own mental health</div>
                    </div>
                    <div class="role-card" data-role="caregiver" onclick="toggleRole(this)">
                        <div class="role-icon">ü§ù</div>
                        <div class="role-name">Caregiver</div>
                        <div class="role-desc">Supporting someone with mental health needs</div>
                    </div>
                    <div class="role-card" data-role="parent" onclick="toggleRole(this)">
                        <div class="role-icon">üë®‚Äçüë©‚Äçüëß</div>
                        <div class="role-name">Parent</div>
                        <div class="role-desc">Supporting my child's mental health</div>
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 30px;">
                    <button class="btn btn-outline" onclick="prevOnboardingStep()">Back</button>
                    <button class="btn btn-full" onclick="nextOnboardingStep()">Continue</button>
                </div>
            </div>

            <!-- Step 3: Journey Stage -->
            <div class="onboarding-step" data-step="3">
                <div class="onboarding-title">Where are you in your journey?</div>
                <div class="onboarding-subtitle">This helps us suggest the right activities</div>
                <div class="role-options">
                    <div class="role-card" data-stage="acute" onclick="selectStage(this)">
                        <div class="role-icon">üÜò</div>
                        <div class="role-name">Acute Support</div>
                        <div class="role-desc">Need immediate coping tools</div>
                    </div>
                    <div class="role-card" data-stage="recovery" onclick="selectStage(this)">
                        <div class="role-icon">üå±</div>
                        <div class="role-name">In Recovery</div>
                        <div class="role-desc">Building stability</div>
                    </div>
                    <div class="role-card" data-stage="maintenance" onclick="selectStage(this)">
                        <div class="role-icon">‚öñÔ∏è</div>
                        <div class="role-name">Maintenance</div>
                        <div class="role-desc">Maintaining wellness</div>
                    </div>
                    <div class="role-card" data-stage="thriving" onclick="selectStage(this)">
                        <div class="role-icon">üåü</div>
                        <div class="role-name">Thriving</div>
                        <div class="role-desc">Focusing on growth</div>
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 30px;">
                    <button class="btn btn-outline" onclick="prevOnboardingStep()">Back</button>
                    <button class="btn btn-full" onclick="nextOnboardingStep()">Continue</button>
                </div>
            </div>

            <!-- Step 4: Preferences -->
            <div class="onboarding-step" data-step="4">
                <div class="onboarding-title">What activities do you prefer?</div>
                <div class="onboarding-subtitle">Select your preferences (you can choose multiple)</div>
                <div class="preference-options">
                    <div class="preference-card" data-pref="solo" onclick="togglePreference(this)">
                        <div class="preference-icon">üßò‚Äç‚ôÄÔ∏è</div>
                        <div class="preference-name">Solo</div>
                        <div class="preference-desc">Individual activities</div>
                    </div>
                    <div class="preference-card" data-pref="group" onclick="togglePreference(this)">
                        <div class="preference-icon">üë•</div>
                        <div class="preference-name">Group</div>
                        <div class="preference-desc">Social activities</div>
                    </div>
                    <div class="preference-card" data-pref="active" onclick="togglePreference(this)">
                        <div class="preference-icon">üèÉ</div>
                        <div class="preference-name">Active</div>
                        <div class="preference-desc">Physical movement</div>
                    </div>
                    <div class="preference-card" data-pref="restful" onclick="togglePreference(this)">
                        <div class="preference-icon">üåô</div>
                        <div class="preference-name">Restful</div>
                        <div class="preference-desc">Calm & restorative</div>
                    </div>
                    <div class="preference-card" data-pref="creative" onclick="togglePreference(this)">
                        <div class="preference-icon">üé®</div>
                        <div class="preference-name">Creative</div>
                        <div class="preference-desc">Art & expression</div>
                    </div>
                    <div class="preference-card" data-pref="quick" onclick="togglePreference(this)">
                        <div class="preference-icon">‚ö°</div>
                        <div class="preference-name">Quick</div>
                        <div class="preference-desc">5 mins or less</div>
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 30px;">
                    <button class="btn btn-outline" onclick="prevOnboardingStep()">Back</button>
                    <button class="btn btn-full" onclick="completeOnboarding()">Start Your Journey</button>
                </div>
            </div>
        </div>
    </div>

    <header>
        <div class="header-content">
            <div class="header-top">
                <div class="logo">üß† MindCare Connect</div>
                <div class="user-role-badge" id="userRoleBadge">Getting Started...</div>
            </div>

            <div class="progress-system">
                <div class="level-container">
                    <div class="level-ring">
                        <div class="level-inner">
                            <div class="level-number" id="userLevel">1</div>
                            <div class="level-label">Level</div>
                        </div>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-item" onclick="showMoodHistory()">
                        <div class="stat-value" id="currentMood">üòä</div>
                        <div class="stat-label">Today's Mood</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="totalPoints">0</div>
                        <div class="stat-label">Points</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="streak">0</div>
                        <div class="stat-label">Streak</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="completedToday">0</div>
                        <div class="stat-label">Today</div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Today's Focus -->
        <div class="focus-card" id="todaysFocus">
            <div class="focus-title">‚ú® Your Personalized Focus for Today</div>
            <div id="focusMessage"></div>
            <div class="focus-recommendations" id="focusRecommendations"></div>
        </div>

        <!-- Daily Challenge -->
        <div class="challenge-card" id="dailyChallenge">
            <div class="challenge-header">
                <div class="challenge-title" id="challengeTitle">üéØ Today's Challenge</div>
                <div class="challenge-reward" id="challengeReward">+50 pts</div>
            </div>
            <div id="challengeDescription"></div>
            <div class="challenge-progress">
                <div class="challenge-progress-fill" id="challengeProgressFill" style="width: 0%"></div>
            </div>
            <div style="margin-top: 10px; font-size: 0.9em; opacity: 0.9;">
                <span id="challengeProgress">0</span> / <span id="challengeGoal">3</span> completed
            </div>
        </div>

        <!-- Mood Tracker -->
        <div class="mood-tracker">
            <h3>How are you feeling today?</h3>
            <div class="mood-quick-check">
                <div class="mood-option" data-mood="great" onclick="quickMoodCheck('great', 'üòä')">
                    <span class="mood-emoji">üòä</span>
                    <span class="mood-label">Great</span>
                </div>
                <div class="mood-option" data-mood="good" onclick="quickMoodCheck('good', 'üôÇ')">
                    <span class="mood-emoji">üôÇ</span>
                    <span class="mood-label">Good</span>
                </div>
                <div class="mood-option" data-mood="okay" onclick="quickMoodCheck('okay', 'üòê')">
                    <span class="mood-emoji">üòê</span>
                    <span class="mood-label">Okay</span>
                </div>
                <div class="mood-option" data-mood="low" onclick="quickMoodCheck('low', 'üòî')">
                    <span class="mood-emoji">üòî</span>
                    <span class="mood-label">Low</span>
                </div>
                <div class="mood-option" data-mood="anxious" onclick="quickMoodCheck('anxious', 'üò∞')">
                    <span class="mood-emoji">üò∞</span>
                    <span class="mood-label">Anxious</span>
                </div>
                <div class="mood-option" data-mood="stressed" onclick="quickMoodCheck('stressed', 'üò§')">
                    <span class="mood-emoji">üò§</span>
                    <span class="mood-label">Stressed</span>
                </div>
            </div>
            <button class="btn btn-outline" style="margin-top: 15px;" onclick="openDetailedMood()">
                Track Detailed Mood
            </button>
        </div>

        <!-- Navigation -->
        <nav>
            <button class="nav-btn active" data-section="exercises">üéØ Activities</button>
            <button class="nav-btn" data-section="learning">üìö Learn</button>
            <button class="nav-btn" data-section="challenges">üèÜ Challenges</button>
            <button class="nav-btn" data-section="progress">üìä Progress</button>
        </nav>

        <!-- Filter Panel -->
        <div class="filter-panel">
            <div class="filter-section">
                <span class="filter-label">Activity Type:</span>
                <div class="filter-tags">
                    <button class="filter-tag active" data-filter-type="type" data-value="all">All</button>
                    <button class="filter-tag" data-filter-type="type" data-value="breathing">ü´Å Breathing</button>
                    <button class="filter-tag" data-filter-type="type" data-value="grounding">üåç Grounding</button>
                    <button class="filter-tag" data-filter-type="type" data-value="mindfulness">üßò Mindfulness</button>
                    <button class="filter-tag" data-filter-type="type" data-value="movement">üèÉ Movement</button>
                    <button class="filter-tag" data-filter-type="type" data-value="creative">üé® Creative</button>
                    <button class="filter-tag" data-filter-type="type" data-value="social">üë• Social</button>
                </div>
            </div>
            <div class="filter-section">
                <span class="filter-label">Style:</span>
                <div class="filter-tags">
                    <button class="filter-tag active" data-filter-type="style" data-value="all">All</button>
                    <button class="filter-tag" data-filter-type="style" data-value="solo">Solo</button>
                    <button class="filter-tag" data-filter-type="style" data-value="group">Group</button>
                    <button class="filter-tag" data-filter-type="style" data-value="active">Active</button>
                    <button class="filter-tag" data-filter-type="style" data-value="restful">Restful</button>
                    <button class="filter-tag" data-filter-type="style" data-value="quick">‚ö° Quick</button>
                </div>
            </div>
        </div>

        <!-- Exercises Section -->
        <section id="exercises" class="section">
            <div class="exercises-grid" id="exercisesGrid"></div>
        </section>

        <!-- Learning Section -->
        <section id="learning" class="section hidden">
            <div class="exercises-grid" id="learningGrid"></div>
        </section>

        <!-- Challenges Section -->
        <section id="challenges" class="section hidden">
            <div class="achievements-grid" id="challengesGrid"></div>
        </section>

        <!-- Progress Section -->
        <section id="progress" class="section hidden">
            <div id="progressContent"></div>
        </section>
    </div>

    <!-- Modal -->
    <div id="exerciseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle"></div>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div id="modalBody"></div>
        </div>
    </div>

    <script>
        // User Data Structure
        let userData = {
            level: 1,
            points: 0,
            streak: 0,
            completedToday: 0,
            roles: [],
            stage: 'acute',
            preferences: [],
            completedExercises: [],
            completedLearning: [],
            achievements: [],
            lastVisit: null,
            onboardingComplete: false,
            moodHistory: [],
            currentMood: null,
            moodDimensions: {
                energy: 5,
                stress: 5,
                focus: 5,
                social: 5
            },
            dailyChallenge: null,
            challengeProgress: 0
        };

        // Expanded Exercise Database
        const exercises = [
            // Breathing & Grounding (For all roles, especially acute)
            {
                id: 'box-breathing',
                name: 'Box Breathing',
                icon: 'ü´Å',
                duration: '2-5 min',
                points: 10,
                category: 'breathing',
                styles: ['solo', 'restful', 'quick'],
                roles: ['patient', 'caregiver', 'parent'],
                stages: ['acute', 'recovery', 'maintenance', 'thriving'],
                unlockLevel: 1
            },
            {
                id: '478-breathing',
                name: '4-7-8 Breathing',
                icon: 'üåä',
                duration: '3 min',
                points: 10,
                category: 'breathing',
                styles: ['solo', 'restful', 'quick'],
                roles: ['patient', 'caregiver', 'parent'],
                stages: ['acute', 'recovery', 'maintenance', 'thriving'],
                unlockLevel: 1
            },
            {
                id: '54321-grounding',
                name: '5-4-3-2-1 Grounding',
                icon: 'üåç',
                duration: '3 min',
                points: 15,
                category: 'grounding',
                styles: ['solo', 'quick'],
                roles: ['patient', 'caregiver', 'parent'],
                stages: ['acute', 'recovery'],
                unlockLevel: 1
            },
            {
                id: 'grounding-walk',
                name: 'Grounding Walk',
                icon: 'üö∂',
                duration: '10 min',
                points: 20,
                category: 'grounding',
                styles: ['solo', 'active'],
                roles: ['patient', 'caregiver'],
                stages: ['recovery', 'maintenance', 'thriving'],
                unlockLevel: 2
            },

            // Mindfulness (Multiple styles)
            {
                id: 'body-scan',
                name: 'Body Scan',
                icon: 'üßò',
                duration: '5 min',
                points: 20,
                category: 'mindfulness',
                styles: ['solo', 'restful'],
                roles: ['patient', 'caregiver'],
                stages: ['recovery', 'maintenance', 'thriving'],
                unlockLevel: 2
            },
            {
                id: 'mindful-eating',
                name: 'Mindful Eating',
                icon: 'üçé',
                duration: '10 min',
                points: 15,
                category: 'mindfulness',
                styles: ['solo', 'restful'],
                roles: ['patient', 'caregiver', 'parent'],
                stages: ['maintenance', 'thriving'],
                unlockLevel: 3
            },
            {
                id: 'sound-meditation',
                name: 'Sound Meditation',
                icon: 'üîî',
                duration: '5 min',
                points: 20,
                category: 'mindfulness',
                styles: ['solo', 'restful'],
                roles: ['patient', 'caregiver'],
                stages: ['recovery', 'maintenance', 'thriving'],
                unlockLevel: 4
            },

            // Movement Activities
            {
                id: 'gentle-stretching',
                name: 'Gentle Stretching',
                icon: 'ü§∏',
                duration: '5 min',
                points: 15,
                category: 'movement',
                styles: ['solo', 'active', 'restful', 'quick'],
                roles: ['patient', 'caregiver'],
                stages: ['recovery', 'maintenance', 'thriving'],
                unlockLevel: 1
            },
            {
                id: 'yoga-flow',
                name: 'Simple Yoga Flow',
                icon: 'üßò‚Äç‚ôÄÔ∏è',
                duration: '15 min',
                points: 25,
                category: 'movement',
                styles: ['solo', 'active'],
                roles: ['patient', 'caregiver'],
                stages: ['maintenance', 'thriving'],
                unlockLevel: 5
            },
            {
                id: 'dance-break',
                name: 'Dance Break',
                icon: 'üíÉ',
                duration: '5 min',
                points: 20,
                category: 'movement',
                styles: ['solo', 'group', 'active', 'quick'],
                roles: ['patient', 'parent'],
                stages: ['maintenance', 'thriving'],
                unlockLevel: 3
            },
            {
                id: 'nature-walk',
                name: 'Nature Walk',
                icon: 'üå≥',
                duration: '20 min',
                points: 30,
                category: 'movement',
                styles: ['solo', 'group', 'active'],
                roles: ['patient', 'caregiver', 'parent'],
                stages: ['recovery', 'maintenance', 'thriving'],
                unlockLevel: 2
            },

            // Creative Activities
            {
                id: 'art-therapy',
                name: 'Free Drawing',
                icon: 'üé®',
                duration: '15 min',
                points: 25,
                category: 'creative',
                styles: ['solo', 'restful'],
                roles: ['patient', 'parent'],
                stages: ['recovery', 'maintenance', 'thriving'],
                unlockLevel: 3
            },
            {
                id: 'coloring',
                name: 'Mindful Coloring',
                icon: 'üñçÔ∏è',
                duration: '10 min',
                points: 15,
                category: 'creative',
                styles: ['solo', 'restful'],
                roles: ['patient', 'caregiver', 'parent'],
                stages: ['acute', 'recovery', 'maintenance', 'thriving'],
                unlockLevel: 1
            },
            {
                id: 'journaling',
                name: 'Gratitude Journal',
                icon: 'üìù',
                duration: '10 min',
                points: 20,
                category: 'creative',
                styles: ['solo', 'restful'],
                roles: ['patient', 'caregiver', 'parent'],
                stages: ['maintenance', 'thriving'],
                unlockLevel: 2
            },
            {
                id: 'music-therapy',
                name: 'Music Listening',
                icon: 'üéµ',
                duration: '10 min',
                points: 15,
                category: 'creative',
                styles: ['solo', 'restful'],
                roles: ['patient', 'caregiver'],
                stages: ['acute', 'recovery', 'maintenance', 'thriving'],
                unlockLevel: 1
            },

            // Social Activities
            {
                id: 'supportive-call',
                name: 'Call a Friend',
                icon: 'üìû',
                duration: '15 min',
                points: 25,
                category: 'social',
                styles: ['group'],
                roles: ['patient', 'caregiver'],
                stages: ['recovery', 'maintenance', 'thriving'],
                unlockLevel: 4
            },
            {
                id: 'family-game',
                name: 'Family Game Time',
                icon: 'üé≤',
                duration: '30 min',
                points: 30,
                category: 'social',
                styles: ['group', 'active'],
                roles: ['parent'],
                stages: ['maintenance', 'thriving'],
                unlockLevel: 3
            },
            {
                id: 'pet-time',
                name: 'Pet Interaction',
                icon: 'üêï',
                duration: '10 min',
                points: 15,
                category: 'social',
                styles: ['solo', 'restful'],
                roles: ['patient', 'caregiver', 'parent'],
                stages: ['recovery', 'maintenance', 'thriving'],
                unlockLevel: 2
            },

            // Caregiver Specific
            {
                id: 'caregiver-breath',
                name: 'Caregiver Reset',
                icon: 'üíÜ',
                duration: '3 min',
                points: 15,
                category: 'breathing',
                styles: ['solo', 'restful', 'quick'],
                roles: ['caregiver', 'parent'],
                stages: ['acute', 'recovery', 'maintenance', 'thriving'],
                unlockLevel: 1
            },
            {
                id: 'boundary-exercise',
                name: 'Boundary Practice',
                icon: 'üõ°Ô∏è',
                duration: '5 min',
                points: 20,
                category: 'mindfulness',
                styles: ['solo', 'quick'],
                roles: ['caregiver', 'parent'],
                stages: ['maintenance', 'thriving'],
                unlockLevel: 5
            },
            {
                id: 'self-compassion',
                name: 'Self-Compassion Break',
                icon: 'üíö',
                duration: '5 min',
                points: 20,
                category: 'mindfulness',
                styles: ['solo', 'restful', 'quick'],
                roles: ['caregiver', 'parent'],
                stages: ['recovery', 'maintenance', 'thriving'],
                unlockLevel: 4
            },

            // Parent Specific
            {
                id: 'parent-child-breathe',
                name: 'Parent-Child Breathing',
                icon: 'üë®‚Äçüëß',
                duration: '5 min',
                points: 25,
                category: 'breathing',
                styles: ['group', 'restful', 'quick'],
                roles: ['parent'],
                stages: ['recovery', 'maintenance', 'thriving'],
                unlockLevel: 2
            },
            {
                id: 'bedtime-routine',
                name: 'Calm Bedtime Routine',
                icon: 'üåô',
                duration: '15 min',
                points: 25,
                category: 'mindfulness',
                styles: ['group', 'restful'],
                roles: ['parent'],
                stages: ['maintenance', 'thriving'],
                unlockLevel: 3
            },
            {
                id: 'playful-movement',
                name: 'Playful Movement',
                icon: 'ü§π',
                duration: '10 min',
                points: 20,
                category: 'movement',
                styles: ['group', 'active'],
                roles: ['parent'],
                stages: ['maintenance', 'thriving'],
                unlockLevel: 2
            },

            // Quick Check-ins
            {
                id: 'mood-check',
                name: 'Mood Check-in',
                icon: 'üòä',
                duration: '1 min',
                points: 5,
                category: 'mindfulness',
                styles: ['solo', 'quick'],
                roles: ['patient', 'caregiver', 'parent'],
                stages: ['acute', 'recovery', 'maintenance', 'thriving'],
                unlockLevel: 1
            },
            {
                id: 'quick-gratitude',
                name: 'Three Gratitudes',
                icon: 'üôè',
                duration: '2 min',
                points: 10,
                category: 'mindfulness',
                styles: ['solo', 'quick'],
                roles: ['patient', 'caregiver', 'parent'],
                stages: ['maintenance', 'thriving'],
                unlockLevel: 1
            }
        ];

        // Expanded Learning Modules
        const learningModules = [
            // Universal Content
            {
                id: 'understanding-anxiety',
                title: 'Understanding Anxiety',
                icon: 'üß©',
                description: 'What anxiety is and how it affects you',
                duration: '3 min',
                unlockLevel: 1,
                roles: ['patient', 'caregiver', 'parent'],
                stages: ['acute', 'recovery'],
                hasQuiz: true,
                content: {
                    text: 'Anxiety is your body\'s natural alarm system. When it detects danger, it triggers a "fight or flight" response to keep you safe. But sometimes this alarm goes off when there\'s no real danger.',
                    takeaways: [
                        { title: 'Right Now', text: 'When you feel anxious, remind yourself: "This is my alarm system. I\'m safe, even if I don\'t feel safe."' },
                        { title: 'Long Term', text: 'Track your anxiety triggers in a simple note on your phone. Patterns will emerge over time.' }
                    ]
                }
            },
            {
                id: 'breathing-science',
                title: 'Why Breathing Works',
                icon: 'ü´Ä',
                description: 'The science behind breathing exercises',
                duration: '2 min',
                unlockLevel: 2,
                roles: ['patient', 'caregiver', 'parent'],
                stages: ['recovery', 'maintenance', 'thriving'],
                content: {
                    text: 'Slow, deep breathing activates your parasympathetic nervous system - your body\'s "calm down" switch. It physically tells your brain that you\'re safe.',
                    takeaways: [
                        { title: 'Right Now', text: 'Try 4-4-4-4 breathing: Inhale 4 counts, hold 4, exhale 4, hold 4. Do 3 rounds.' },
                        { title: 'Long Term', text: 'Practice breathing exercises when calm to make them more effective during stress.' }
                    ]
                }
            },

            // Caregiver Focused
            {
                id: 'caregiver-burnout',
                title: 'Preventing Caregiver Burnout',
                icon: 'üî•',
                description: 'Recognize and prevent burnout',
                duration: '5 min',
                unlockLevel: 3,
                roles: ['caregiver', 'parent'],
                stages: ['recovery', 'maintenance', 'thriving'],
                content: {
                    text: 'Caregiver burnout is physical, emotional, and mental exhaustion from caregiving. Signs include feeling overwhelmed, irritable, or detached. You can\'t pour from an empty cup.',
                    takeaways: [
                        { title: 'Right Now', text: 'Take 5 minutes for yourself today. It\'s not selfish - it\'s necessary.' },
                        { title: 'Long Term', text: 'Schedule regular "you time" on your calendar. Treat it as non-negotiable as medical appointments.' }
                    ]
                }
            },
            {
                id: 'setting-boundaries',
                title: 'Setting Healthy Boundaries',
                icon: 'üõ°Ô∏è',
                description: 'Protect your energy and relationships',
                duration: '4 min',
                unlockLevel: 5,
                roles: ['caregiver', 'parent'],
                stages: ['maintenance', 'thriving'],
                content: {
                    text: 'Boundaries are not walls - they\'re guidelines for how you want to be treated. They protect your energy and preserve relationships by preventing resentment.',
                    takeaways: [
                        { title: 'Right Now', text: 'Identify one situation where you consistently feel drained. What boundary would help?' },
                        { title: 'Long Term', text: 'Practice saying no to small things (low stakes) to build comfort with the word.' }
                    ]
                }
            },
            {
                id: 'compassion-fatigue',
                title: 'Understanding Compassion Fatigue',
                icon: 'üíî',
                description: 'When caring too much hurts',
                duration: '4 min',
                unlockLevel: 6,
                roles: ['caregiver', 'parent'],
                stages: ['recovery', 'maintenance'],
                content: {
                    text: 'Compassion fatigue is the emotional and physical exhaustion from constant exposure to others\' suffering. Unlike burnout, it can happen suddenly and affects your ability to empathize.',
                    takeaways: [
                        { title: 'Right Now', text: 'Notice if you feel numb or detached. This is a sign to prioritize self-care immediately.' },
                        { title: 'Long Term', text: 'Create daily rituals that separate caregiving from personal time. Even 10 minutes helps.' }
                    ]
                }
            },

            // Parent Focused
            {
                id: 'talking-to-kids',
                title: 'Talking to Kids About Mental Health',
                icon: 'üí¨',
                description: 'Age-appropriate conversations',
                duration: '5 min',
                unlockLevel: 2,
                roles: ['parent'],
                stages: ['recovery', 'maintenance', 'thriving'],
                content: {
                    text: 'Kids need simple, honest explanations about feelings. Use their language, validate their emotions, and model healthy coping. "Everyone feels sad/scared sometimes. Let\'s talk about what helps."',
                    takeaways: [
                        { title: 'Right Now', text: 'Ask your child: "What color is your feeling today?" Colors can be easier than words.' },
                        { title: 'Long Term', text: 'Make feelings a regular topic. Daily check-ins normalize emotional conversations.' }
                    ]
                }
            },
            {
                id: 'modeling-coping',
                title: 'Modeling Healthy Coping',
                icon: 'üë®‚Äçüë©‚Äçüëß',
                description: 'Teaching through your actions',
                duration: '3 min',
                unlockLevel: 4,
                roles: ['parent'],
                stages: ['maintenance', 'thriving'],
                content: {
                    text: 'Children learn coping strategies by watching you. When you say "I\'m feeling frustrated, so I\'m going to take deep breaths," you teach them that emotions are manageable.',
                    takeaways: [
                        { title: 'Right Now', text: 'Next time you\'re upset, narrate what you\'re doing: "I need a break. I\'m going to..." ' },
                        { title: 'Long Term', text: 'Practice coping strategies together as family rituals (morning stretches, bedtime breathing).' }
                    ]
                }
            },
            {
                id: 'validating-emotions',
                title: 'Validating Children\'s Emotions',
                icon: 'üíô',
                description: 'Making feelings okay',
                duration: '4 min',
                unlockLevel: 3,
                roles: ['parent'],
                stages: ['recovery', 'maintenance', 'thriving'],
                content: {
                    text: 'Validation doesn\'t mean agreeing - it means acknowledging feelings are real and okay. "I see you\'re angry" is more powerful than "Don\'t be angry." Kids who feel heard regulate emotions better.',
                    takeaways: [
                        { title: 'Right Now', text: 'Replace "You\'re fine" with "I see this is hard for you." Notice the difference.' },
                        { title: 'Long Term', text: 'Create an emotion chart at home. Let kids point to how they feel without needing perfect words.' }
                    ]
                }
            },

            // Patient Growth
            {
                id: 'cognitive-distortions',
                title: 'Common Thought Traps',
                icon: 'üß†',
                description: 'Recognize unhelpful thinking patterns',
                duration: '5 min',
                unlockLevel: 4,
                roles: ['patient'],
                stages: ['recovery', 'maintenance', 'thriving'],
                hasQuiz: true,
                content: {
                    text: 'Your mind sometimes plays tricks on you with automatic negative thoughts. Common traps: all-or-nothing thinking, catastrophizing, mind reading. Recognizing them is the first step to challenging them.',
                    takeaways: [
                        { title: 'Right Now', text: 'When you notice a negative thought, ask: "Would I say this to a friend?" Usually not.' },
                        { title: 'Long Term', text: 'Start a thought log. Write: Situation ‚Üí Thought ‚Üí Feeling ‚Üí Alternative thought.' }
                    ]
                }
            },
            {
                id: 'sleep-hygiene',
                title: 'Better Sleep Basics',
                icon: 'üò¥',
                description: 'Simple steps for better rest',
                duration: '4 min',
                unlockLevel: 3,
                roles: ['patient', 'caregiver'],
                stages: ['recovery', 'maintenance', 'thriving'],
                content: {
                    text: 'Quality sleep is foundational for mental health. Your brain needs 7-9 hours to process emotions and consolidate memories. Poor sleep amplifies anxiety and depression.',
                    takeaways: [
                        { title: 'Right Now', text: 'Set an alarm for 30 minutes before bedtime to start your wind-down routine tonight.' },
                        { title: 'Long Term', text: 'Keep your bedroom cool (65-68¬∞F), dark, and reserve it for sleep only.' }
                    ]
                }
            },

            // Advanced Topics
            {
                id: 'values-compass',
                title: 'Your Values Compass',
                icon: 'üß≠',
                description: 'Identify what matters most',
                duration: '5 min',
                unlockLevel: 7,
                roles: ['patient', 'caregiver', 'parent'],
                stages: ['thriving'],
                content: {
                    text: 'Values are your internal compass - they guide decisions and give life meaning. When you live aligned with your values, you feel more fulfilled even during difficult times.',
                    takeaways: [
                        { title: 'Right Now', text: 'Write down 3-5 words that describe the person you want to be (not what you do, but who you are).' },
                        { title: 'Long Term', text: 'Make decisions by asking: "Does this align with my values?" It simplifies complex choices.' }
                    ]
                }
            },
            {
                id: 'building-resilience',
                title: 'Building Resilience',
                icon: 'üå±',
                description: 'Bouncing back from challenges',
                duration: '5 min',
                unlockLevel: 8,
                roles: ['patient', 'caregiver', 'parent'],
                stages: ['maintenance', 'thriving'],
                content: {
                    text: 'Resilience isn\'t about avoiding hard times - it\'s about recovering from them. It\'s built through connections, self-care, purpose, and realistic thinking. It\'s a skill you can develop.',
                    takeaways: [
                        { title: 'Right Now', text: 'Think of a past challenge you overcame. What strengths did you use? You still have those.' },
                        { title: 'Long Term', text: 'Build your "resilience toolkit": people you can call, activities that restore you, mantras that help.' }
                    ]
                }
            }
        ];

        // Achievements
        const achievements = [
            { id: 'first-step', name: 'First Step', emoji: 'üë£', description: 'Complete your first activity', requirement: 1, type: 'exercises' },
            { id: 'dedicated', name: 'Dedicated', emoji: '‚≠ê', description: 'Complete 10 activities', requirement: 10, type: 'exercises' },
            { id: 'committed', name: 'Committed', emoji: 'üíé', description: 'Complete 25 activities', requirement: 25, type: 'exercises' },
            { id: 'streak-3', name: '3-Day Streak', emoji: 'üî•', description: 'Practice 3 days in a row', requirement: 3, type: 'streak' },
            { id: 'streak-7', name: 'Week Warrior', emoji: '‚ö°', description: '7-day streak', requirement: 7, type: 'streak' },
            { id: 'mood-tracker', name: 'Mood Aware', emoji: 'üé≠', description: 'Log mood 7 days', requirement: 7, type: 'mood' },
            { id: 'learner', name: 'Eager Learner', emoji: 'üìö', description: 'Complete 5 modules', requirement: 5, type: 'learning' },
            { id: 'level-5', name: 'Growing Strong', emoji: 'üå±', description: 'Reach level 5', requirement: 5, type: 'level' },
            { id: 'challenge-master', name: 'Challenge Master', emoji: 'üèÜ', description: 'Complete 10 daily challenges', requirement: 10, type: 'challenges' }
        ];

        // Initialize App
        function init() {
            loadUserData();
            if (!userData.onboardingComplete) {
                showOnboarding();
            } else {
                updateUI();
                generateDailyChallenge();
                generateTodaysFocus();
            }
            setupEventListeners();
        }

        // Load Data
        function loadUserData() {
            const saved = localStorage.getItem('mindcareUserData');
            if (saved) {
                userData = { ...userData, ...JSON.parse(saved) };
                updateStreak();
            }
        }

        // Save Data
        function saveUserData() {
            localStorage.setItem('mindcareUserData', JSON.stringify(userData));
        }

        // Update Streak
        function updateStreak() {
            const today = new Date().toDateString();
            const lastVisit = userData.lastVisit ? new Date(userData.lastVisit).toDateString() : null;

            if (lastVisit === today) {
                return;
            } else if (lastVisit) {
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                if (lastVisit === yesterday.toDateString()) {
                    userData.streak++;
                } else {
                    userData.streak = 1;
                }
            } else {
                userData.streak = 1;
            }

            userData.lastVisit = new Date().toISOString();
            userData.completedToday = 0;
            saveUserData();
        }

        // Onboarding Functions
        let currentOnboardingStep = 1;
        let selectedRoles = [];
        let selectedStage = '';
        let selectedPreferences = [];

        function showOnboarding() {
            document.getElementById('onboardingModal').classList.remove('hidden');
        }

        function nextOnboardingStep() {
            document.querySelector(`[data-step="${currentOnboardingStep}"]`).classList.remove('active');
            currentOnboardingStep++;
            document.querySelector(`[data-step="${currentOnboardingStep}"]`).classList.add('active');
        }

        function prevOnboardingStep() {
            document.querySelector(`[data-step="${currentOnboardingStep}"]`).classList.remove('active');
            currentOnboardingStep--;
            document.querySelector(`[data-step="${currentOnboardingStep}"]`).classList.add('active');
        }

        function toggleRole(element) {
            element.classList.toggle('selected');
            const role = element.dataset.role;
            if (selectedRoles.includes(role)) {
                selectedRoles = selectedRoles.filter(r => r !== role);
            } else {
                selectedRoles.push(role);
            }
        }

        function selectStage(element) {
            document.querySelectorAll('[data-stage]').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
            selectedStage = element.dataset.stage;
        }

        function togglePreference(element) {
            element.classList.toggle('selected');
            const pref = element.dataset.pref;
            if (selectedPreferences.includes(pref)) {
                selectedPreferences = selectedPreferences.filter(p => p !== pref);
            } else {
                selectedPreferences.push(pref);
            }
        }

        function completeOnboarding() {
            if (selectedRoles.length === 0) {
                alert('Please select at least one role');
                return;
            }
            if (!selectedStage) {
                alert('Please select your journey stage');
                return;
            }

            userData.roles = selectedRoles;
            userData.stage = selectedStage;
            userData.preferences = selectedPreferences;
            userData.onboardingComplete = true;
            saveUserData();

            document.getElementById('onboardingModal').classList.add('hidden');
            updateUI();
            generateDailyChallenge();
            generateTodaysFocus();

            confetti({
                particleCount: 200,
                spread: 100,
                origin: { y: 0.5 }
            });
        }

        // Mood Tracking
        function quickMoodCheck(mood, emoji) {
            document.querySelectorAll('.mood-option').forEach(el => el.classList.remove('selected'));
            event.target.closest('.mood-option').classList.add('selected');

            userData.currentMood = mood;
            userData.moodHistory.push({
                date: new Date().toISOString(),
                mood: mood,
                emoji: emoji
            });

            document.getElementById('currentMood').textContent = emoji;
            saveUserData();
            generateTodaysFocus(); // Regenerate based on mood
        }

        function openDetailedMood() {
            const modal = document.getElementById('exerciseModal');
            const title = document.getElementById('modalTitle');
            const body = document.getElementById('modalBody');

            title.innerHTML = 'üé≠ Detailed Mood Check-in';
            body.innerHTML = `
                <div class="mood-dimensions">
                    <div class="mood-dimension">
                        <div class="dimension-label">
                            <span>‚ö° Energy Level</span>
                            <span id="energyValue">5</span>
                        </div>
                        <input type="range" min="1" max="10" value="${userData.moodDimensions.energy}" class="dimension-slider"
                               oninput="updateDimension('energy', this.value)">
                        <div style="display: flex; justify-content: space-between; font-size: 0.8em; color: var(--text-medium); margin-top: 5px;">
                            <span>Exhausted</span>
                            <span>Energized</span>
                        </div>
                    </div>
                    <div class="mood-dimension">
                        <div class="dimension-label">
                            <span>üò§ Stress Level</span>
                            <span id="stressValue">5</span>
                        </div>
                        <input type="range" min="1" max="10" value="${userData.moodDimensions.stress}" class="dimension-slider"
                               oninput="updateDimension('stress', this.value)">
                        <div style="display: flex; justify-content: space-between; font-size: 0.8em; color: var(--text-medium); margin-top: 5px;">
                            <span>Relaxed</span>
                            <span>Overwhelmed</span>
                        </div>
                    </div>
                    <div class="mood-dimension">
                        <div class="dimension-label">
                            <span>üéØ Focus Level</span>
                            <span id="focusValue">5</span>
                        </div>
                        <input type="range" min="1" max="10" value="${userData.moodDimensions.focus}" class="dimension-slider"
                               oninput="updateDimension('focus', this.value)">
                        <div style="display: flex; justify-content: space-between; font-size: 0.8em; color: var(--text-medium); margin-top: 5px;">
                            <span>Scattered</span>
                            <span>Focused</span>
                        </div>
                    </div>
                    <div class="mood-dimension">
                        <div class="dimension-label">
                            <span>üë• Social Battery</span>
                            <span id="socialValue">5</span>
                        </div>
                        <input type="range" min="1" max="10" value="${userData.moodDimensions.social}" class="dimension-slider"
                               oninput="updateDimension('social', this.value)">
                        <div style="display: flex; justify-content: space-between; font-size: 0.8em; color: var(--text-medium); margin-top: 5px;">
                            <span>Drained</span>
                            <span>Social</span>
                        </div>
                    </div>
                </div>
                <button class="btn btn-full" style="margin-top: 20px;" onclick="saveMoodDimensions()">
                    Save Mood Check-in (+10 pts)
                </button>
            `;
            modal.style.display = 'block';
        }

        function updateDimension(dimension, value) {
            document.getElementById(`${dimension}Value`).textContent = value;
            userData.moodDimensions[dimension] = parseInt(value);
        }

        function saveMoodDimensions() {
            userData.points += 10;
            saveUserData();
            updateUI();
            closeModal();
            generateTodaysFocus();

            confetti({
                particleCount: 50,
                spread: 50,
                origin: { y: 0.6 }
            });
        }

        // Generate Today's Focus
        function generateTodaysFocus() {
            const focusMessage = document.getElementById('focusMessage');
            const focusRecommendations = document.getElementById('focusRecommendations');

            let message = '';
            let recommendations = [];

            // Personalize based on mood dimensions
            if (userData.moodDimensions.stress > 7) {
                message = 'You seem stressed today. Let\'s focus on calming activities.';
                recommendations = exercises.filter(ex =>
                    ex.styles.includes('restful') &&
                    (ex.category === 'breathing' || ex.category === 'grounding') &&
                    matchesUserContext(ex)
                ).slice(0, 3);
            } else if (userData.moodDimensions.energy < 3) {
                message = 'Energy is low today. Gentle, restorative activities might help.';
                recommendations = exercises.filter(ex =>
                    ex.styles.includes('restful') &&
                    matchesUserContext(ex)
                ).slice(0, 3);
            } else if (userData.moodDimensions.energy > 7) {
                message = 'You have good energy! Try something active.';
                recommendations = exercises.filter(ex =>
                    ex.styles.includes('active') &&
                    matchesUserContext(ex)
                ).slice(0, 3);
            } else if (userData.moodDimensions.social < 3) {
                message = 'Social battery is low. Solo activities are perfect right now.';
                recommendations = exercises.filter(ex =>
                    ex.styles.includes('solo') &&
                    matchesUserContext(ex)
                ).slice(0, 3);
            } else {
                message = 'Based on your preferences and stage, here are today\'s top picks:';
                recommendations = exercises.filter(ex => matchesUserContext(ex))
                    .sort(() => 0.5 - Math.random())
                    .slice(0, 3);
            }

            focusMessage.textContent = message;
            focusRecommendations.innerHTML = recommendations.map(ex => `
                <div class="focus-item" onclick="startExercise('${ex.id}')">
                    <div class="focus-item-icon">${ex.icon}</div>
                    <div class="focus-item-name">${ex.name}</div>
                    <div class="focus-item-reason">${ex.duration}</div>
                </div>
            `).join('');
        }

        // Generate Daily Challenge
        function generateDailyChallenge() {
            const today = new Date().toDateString();
            if (userData.dailyChallenge && userData.dailyChallenge.date === today) {
                updateChallengeDisplay();
                return;
            }

            // New challenge for today
            const challenges = [
                { title: 'Triple Practice', description: 'Complete 3 activities today', goal: 3, type: 'exercises' },
                { title: 'Mood Master', description: 'Log detailed mood 3 times', goal: 3, type: 'mood' },
                { title: 'Learning Streak', description: 'Complete 2 learning modules', goal: 2, type: 'learning' },
                { title: 'Variety Pack', description: 'Try 3 different activity types', goal: 3, type: 'variety' },
                { title: 'Quick Wins', description: 'Complete 5 quick activities', goal: 5, type: 'quick' }
            ];

            const challenge = challenges[Math.floor(Math.random() * challenges.length)];
            userData.dailyChallenge = {
                ...challenge,
                date: today,
                progress: 0
            };
            userData.challengeProgress = 0;
            saveUserData();
            updateChallengeDisplay();
        }

        function updateChallengeDisplay() {
            if (!userData.dailyChallenge) return;

            document.getElementById('challengeTitle').textContent = 'üéØ ' + userData.dailyChallenge.title;
            document.getElementById('challengeDescription').textContent = userData.dailyChallenge.description;
            document.getElementById('challengeProgress').textContent = userData.dailyChallenge.progress;
            document.getElementById('challengeGoal').textContent = userData.dailyChallenge.goal;

            const percentage = (userData.dailyChallenge.progress / userData.dailyChallenge.goal) * 100;
            document.getElementById('challengeProgressFill').style.width = percentage + '%';

            if (userData.dailyChallenge.progress >= userData.dailyChallenge.goal) {
                document.getElementById('challengeTitle').textContent = '‚úÖ Challenge Complete!';
            }
        }

        // Helper Functions
        function matchesUserContext(item) {
            const matchesRole = item.roles.some(role => userData.roles.includes(role));
            const matchesStage = item.stages.includes(userData.stage);
            const matchesLevel = userData.level >= item.unlockLevel;
            return matchesRole && matchesStage && matchesLevel;
        }

        // Filter System
        let activeFilters = {
            type: 'all',
            style: 'all'
        };

        function setupEventListeners() {
            // Navigation
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));

                    btn.classList.add('active');
                    const section = btn.dataset.section;
                    document.getElementById(section).classList.remove('hidden');

                    if (section === 'learning') renderLearning();
                    if (section === 'challenges') renderAchievements();
                    if (section === 'progress') renderProgress();
                });
            });

            // Filters
            document.querySelectorAll('.filter-tag').forEach(tag => {
                tag.addEventListener('click', () => {
                    const filterType = tag.dataset.filterType;
                    const value = tag.dataset.value;

                    document.querySelectorAll(`[data-filter-type="${filterType}"]`).forEach(t => t.classList.remove('active'));
                    tag.classList.add('active');

                    activeFilters[filterType] = value;
                    renderExercises();
                });
            });
        }

        // Render Functions
        function renderExercises() {
            const grid = document.getElementById('exercisesGrid');

            let filtered = exercises.filter(ex => matchesUserContext(ex));

            // Apply filters
            if (activeFilters.type !== 'all') {
                filtered = filtered.filter(ex => ex.category === activeFilters.type);
            }
            if (activeFilters.style !== 'all') {
                filtered = filtered.filter(ex => ex.styles.includes(activeFilters.style));
            }

            // Sort: recommended first
            filtered.sort((a, b) => {
                const aMatches = a.styles.filter(s => userData.preferences.includes(s)).length;
                const bMatches = b.styles.filter(s => userData.preferences.includes(s)).length;
                return bMatches - aMatches;
            });

            grid.innerHTML = filtered.map(ex => {
                const isRecommended = ex.styles.some(s => userData.preferences.includes(s));
                const isCompleted = userData.completedExercises.includes(ex.id);
                const multiplier = userData.moodDimensions.stress > 7 && ex.styles.includes('restful') ? 2 : 1;

                return `
                    <div class="exercise-card ${isRecommended ? 'recommended' : ''}" onclick="startExercise('${ex.id}')">
                        ${multiplier > 1 ? `<div class="multiplier-badge">${multiplier}x Points!</div>` : ''}
                        <div class="exercise-icon">${ex.icon}</div>
                        <div class="exercise-name">${ex.name}</div>
                        <div class="exercise-tags">
                            ${ex.styles.slice(0, 2).map(s => `<span class="exercise-tag">${s}</span>`).join('')}
                        </div>
                        <div class="exercise-points">+${ex.points * multiplier} pts</div>
                        ${isCompleted ? '<div style="margin-top: 8px;">‚úÖ</div>' : ''}
                    </div>
                `;
            }).join('');
        }

        function renderLearning() {
            const grid = document.getElementById('learningGrid');

            let filtered = learningModules.filter(module => matchesUserContext(module));

            grid.innerHTML = filtered.map(module => {
                const isCompleted = userData.completedLearning.includes(module.id);

                return `
                    <div class="exercise-card" onclick="openLearning('${module.id}')">
                        <div class="exercise-icon">${module.icon}</div>
                        <div class="exercise-name">${module.title}</div>
                        <div style="font-size: 0.85em; color: var(--text-medium); margin: 10px 0;">${module.description}</div>
                        <div class="exercise-points">+30 pts</div>
                        ${isCompleted ? '<div style="margin-top: 8px;">‚úÖ</div>' : ''}
                        ${module.hasQuiz ? '<div style="margin-top: 5px; font-size: 0.8em;">üìù Quiz</div>' : ''}
                    </div>
                `;
            }).join('');
        }

        function renderAchievements() {
            const grid = document.getElementById('challengesGrid');

            grid.innerHTML = achievements.map(achievement => {
                let progress = 0;
                switch(achievement.type) {
                    case 'exercises':
                        progress = userData.completedExercises.length;
                        break;
                    case 'streak':
                        progress = userData.streak;
                        break;
                    case 'learning':
                        progress = userData.completedLearning.length;
                        break;
                    case 'level':
                        progress = userData.level;
                        break;
                    case 'mood':
                        progress = userData.moodHistory.length;
                        break;
                }

                const isUnlocked = progress >= achievement.requirement;

                return `
                    <div class="achievement-item ${isUnlocked ? 'unlocked' : 'locked'}">
                        <div class="achievement-badge">${achievement.emoji}</div>
                        <div class="achievement-name">${achievement.name}</div>
                        <div class="achievement-desc">${achievement.description}</div>
                        <div style="margin-top: 8px; font-weight: 600; font-size: 0.9em;">
                            ${progress}/${achievement.requirement}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderProgress() {
            const content = document.getElementById('progressContent');
            const pointsToNext = 100 - (userData.points % 100);
            const nextLevel = userData.level + 1;

            content.innerHTML = `
                <div style="background: var(--bg-card); border-radius: 15px; padding: 25px; margin-bottom: 20px; box-shadow: var(--shadow); border: 1px solid var(--border);">
                    <h2>üìä Your Journey</h2>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
                        <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, var(--primary), var(--purple)); color: white; border-radius: 12px;">
                            <div style="font-size: 3em; font-weight: bold;">${userData.level}</div>
                            <div style="font-size: 1.1em;">Current Level</div>
                            <div style="font-size: 0.9em; margin-top: 10px;">${pointsToNext} pts to Level ${nextLevel}</div>
                        </div>
                        <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, var(--gold), #FFA500); color: white; border-radius: 12px;">
                            <div style="font-size: 3em; font-weight: bold;">${userData.points}</div>
                            <div style="font-size: 1.1em;">Total Points</div>
                        </div>
                        <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, var(--secondary), #059669); color: white; border-radius: 12px;">
                            <div style="font-size: 3em; font-weight: bold;">${userData.streak}</div>
                            <div style="font-size: 1.1em;">Day Streak</div>
                        </div>
                    </div>
                </div>

                <div style="background: var(--bg-card); border-radius: 15px; padding: 25px; box-shadow: var(--shadow); border: 1px solid var(--border);">
                    <h2>üéØ Activity Breakdown</h2>
                    <div style="margin-top: 20px;">
                        <div style="margin-bottom: 15px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>Completed Activities</span>
                                <span style="font-weight: bold;">${userData.completedExercises.length}</span>
                            </div>
                            <div style="background: var(--bg-main); height: 10px; border-radius: 10px; overflow: hidden;">
                                <div style="background: var(--primary); height: 100%; width: ${Math.min(userData.completedExercises.length * 4, 100)}%; border-radius: 10px;"></div>
                            </div>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>Learning Modules</span>
                                <span style="font-weight: bold;">${userData.completedLearning.length}</span>
                            </div>
                            <div style="background: var(--bg-main); height: 10px; border-radius: 10px; overflow: hidden;">
                                <div style="background: var(--secondary); height: 100%; width: ${(userData.completedLearning.length / learningModules.length) * 100}%; border-radius: 10px;"></div>
                            </div>
                        </div>
                        <div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>Mood Logs</span>
                                <span style="font-weight: bold;">${userData.moodHistory.length}</span>
                            </div>
                            <div style="background: var(--bg-main); height: 10px; border-radius: 10px; overflow: hidden;">
                                <div style="background: var(--pink); height: 100%; width: ${Math.min(userData.moodHistory.length * 10, 100)}%; border-radius: 10px;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Update UI
        function updateUI() {
            document.getElementById('userLevel').textContent = userData.level;
            document.getElementById('totalPoints').textContent = userData.points;
            document.getElementById('streak').textContent = userData.streak;
            document.getElementById('completedToday').textContent = userData.completedToday;

            const roleLabels = {
                patient: 'Patient',
                caregiver: 'Caregiver',
                parent: 'Parent'
            };
            document.getElementById('userRoleBadge').textContent = userData.roles.map(r => roleLabels[r]).join(' ‚Ä¢ ');

            const levelProgress = ((userData.points % 100) / 100) * 360;
            document.querySelector('.level-ring').style.setProperty('--level-progress', `${levelProgress}deg`);

            renderExercises();
            updateChallengeDisplay();
        }

        // Exercise Functions
        function startExercise(exerciseId) {
            const exercise = exercises.find(ex => ex.id === exerciseId);
            if (!exercise) return;

            const modal = document.getElementById('exerciseModal');
            const title = document.getElementById('modalTitle');
            const body = document.getElementById('modalBody');

            title.innerHTML = `${exercise.icon} ${exercise.name}`;

            const multiplier = userData.moodDimensions.stress > 7 && exercise.styles.includes('restful') ? 2 : 1;

            // Generic exercise content with complete button
            body.innerHTML = `
                <p style="margin-bottom: 20px; font-size: 1.1em;">
                    Duration: ${exercise.duration}<br>
                    ${exercise.styles.map(s => `<span style="background: var(--bg-main); padding: 5px 10px; border-radius: 10px; margin: 5px; display: inline-block;">${s}</span>`).join('')}
                </p>
                <div style="background: var(--bg-main); padding: 20px; border-radius: 12px; margin: 20px 0;">
                    <p style="font-size: 1.05em; line-height: 1.8;">
                        Take your time with this activity. Focus on the present moment and be gentle with yourself.
                    </p>
                </div>
                <button class="btn btn-success btn-full" onclick="completeExercise('${exercise.id}', ${exercise.points}, ${multiplier})">
                    Complete Activity (+${exercise.points * multiplier} pts)
                </button>
            `;

            modal.style.display = 'block';
        }

        function completeExercise(exerciseId, points, multiplier = 1) {
            if (!userData.completedExercises.includes(exerciseId)) {
                userData.completedExercises.push(exerciseId);
            }

            userData.points += (points * multiplier);
            userData.completedToday++;

            // Update challenge progress
            if (userData.dailyChallenge) {
                if (userData.dailyChallenge.type === 'exercises' || userData.dailyChallenge.type === 'quick') {
                    userData.dailyChallenge.progress++;
                    updateChallengeDisplay();
                }
            }

            // Check for level up
            const newLevel = Math.floor(userData.points / 100) + 1;
            if (newLevel > userData.level) {
                userData.level = newLevel;
                showLevelUp(newLevel);
            }

            saveUserData();
            updateUI();
            closeModal();

            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.6 }
            });
        }

        function openLearning(moduleId) {
            const module = learningModules.find(m => m.id === moduleId);
            if (!module) return;

            const modal = document.getElementById('exerciseModal');
            const title = document.getElementById('modalTitle');
            const body = document.getElementById('modalBody');

            title.innerHTML = `${module.icon} ${module.title}`;

            body.innerHTML = `
                <div style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.05), rgba(139, 92, 246, 0.05)); border: 2px solid var(--primary); border-radius: 15px; padding: 25px;">
                    <p style="font-size: 1.1em; line-height: 1.8; margin-bottom: 20px;">${module.content.text}</p>

                    ${module.content.takeaways.map(takeaway => `
                        <div style="background: white; border-left: 4px solid var(--secondary); padding: 15px; margin: 15px 0; border-radius: 8px;">
                            <div style="font-weight: 600; color: var(--secondary); margin-bottom: 8px;">üí° ${takeaway.title}</div>
                            <div>${takeaway.text}</div>
                        </div>
                    `).join('')}

                    <button class="btn btn-success btn-full" style="margin-top: 20px;" onclick="completeLearning('${module.id}')">
                        ‚úÖ Mark as Complete (+30 pts)
                    </button>
                </div>
            `;

            modal.style.display = 'block';
        }

        function completeLearning(moduleId) {
            if (!userData.completedLearning.includes(moduleId)) {
                userData.completedLearning.push(moduleId);
            }

            userData.points += 30;

            // Update challenge
            if (userData.dailyChallenge && userData.dailyChallenge.type === 'learning') {
                userData.dailyChallenge.progress++;
                updateChallengeDisplay();
            }

            const newLevel = Math.floor(userData.points / 100) + 1;
            if (newLevel > userData.level) {
                userData.level = newLevel;
                showLevelUp(newLevel);
            }

            saveUserData();
            updateUI();
            closeModal();

            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.6 }
            });
        }

        function showLevelUp(level) {
            confetti({
                particleCount: 200,
                spread: 100,
                origin: { y: 0.5 }
            });

            alert(`üéâ Level Up! You're now level ${level}!\n\nNew content unlocked!`);
        }

        function closeModal() {
            document.getElementById('exerciseModal').style.display = 'none';
        }

        function showMoodHistory() {
            alert('Mood history feature - track your emotional patterns over time!');
        }

        // Close modal on outside click
        window.onclick = function(event) {
            const modal = document.getElementById('exerciseModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // Initialize
        init();
    </script>
</body>
</html>